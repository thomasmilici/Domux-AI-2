<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Reader - Domux AI</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #00ff00; }
        .loading { color: #ffff00; }
        .error {
            background: #ff000020;
            border-left: 4px solid #ff0000;
            padding: 10px;
            margin: 10px 0;
        }
        .warn {
            background: #ffff0020;
            border-left: 4px solid #ffff00;
            padding: 10px;
            margin: 10px 0;
        }
        .log {
            background: #0000ff20;
            border-left: 4px solid #0000ff;
            padding: 10px;
            margin: 10px 0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .stat-card {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }
        pre {
            background: #000;
            padding: 10px;
            overflow-x: auto;
            border-radius: 5px;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            margin: 10px 5px;
        }
        button:hover {
            background: #00cc00;
        }
        .filters {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üìã Log Reader - Domux AI</h1>
    <div id="status" class="loading">Caricamento log da Firestore...</div>

    <div class="filters">
        <button onclick="filterLogs('all')">Tutti</button>
        <button onclick="filterLogs('error')" style="background: #ff0000; color: white;">Solo Errori</button>
        <button onclick="filterLogs('warn')" style="background: #ffff00; color: black;">Solo Warning</button>
        <button onclick="filterLogs('log')" style="background: #0000ff; color: white;">Solo Info</button>
        <button onclick="loadLogs()">üîÑ Ricarica</button>
    </div>

    <div id="stats" class="stats"></div>
    <div id="logs"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyC4lP5_1RCijQniqug5kmcWZFxG7Ub0Bug",
            authDomain: "progettista-ai.firebaseapp.com",
            projectId: "progettista-ai",
            storageBucket: "progettista-ai.firebasestorage.app",
            messagingSenderId: "935797437515",
            appId: "1:935797437515:web:24cce40d50f79c594c49ce"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let allLogs = [];
        let currentFilter = 'all';

        async function loadLogs() {
            document.getElementById('status').innerHTML = '‚è≥ Caricamento log...';
            document.getElementById('logs').innerHTML = '';

            try {
                const logsQuery = query(
                    collection(db, 'logs'),
                    orderBy('timestamp', 'desc'),
                    limit(100)
                );

                const snapshot = await getDocs(logsQuery);
                allLogs = [];

                snapshot.forEach(doc => {
                    allLogs.push({ id: doc.id, ...doc.data() });
                });

                document.getElementById('status').innerHTML = `‚úÖ Caricati ${allLogs.length} log`;

                displayStats();
                displayLogs();
            } catch (error) {
                document.getElementById('status').innerHTML = `‚ùå Errore: ${error.message}`;
                console.error('Error loading logs:', error);
            }
        }

        function displayStats() {
            const errors = allLogs.filter(l => l.level === 'error').length;
            const warns = allLogs.filter(l => l.level === 'warn').length;
            const infos = allLogs.filter(l => l.level === 'log').length;

            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${allLogs.length}</div>
                    <div>Totale</div>
                </div>
                <div class="stat-card" style="color: #ff0000;">
                    <div class="stat-number">${errors}</div>
                    <div>Errori</div>
                </div>
                <div class="stat-card" style="color: #ffff00;">
                    <div class="stat-number">${warns}</div>
                    <div>Warning</div>
                </div>
                <div class="stat-card" style="color: #0000ff;">
                    <div class="stat-number">${infos}</div>
                    <div>Info</div>
                </div>
            `;
        }

        function displayLogs() {
            const filtered = currentFilter === 'all'
                ? allLogs
                : allLogs.filter(l => l.level === currentFilter);

            const logsHtml = filtered.map((log, index) => {
                const contextHtml = log.context
                    ? `<pre>${JSON.stringify(log.context, null, 2)}</pre>`
                    : '';

                return `
                    <div class="${log.level}">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${log.level.toUpperCase()}</strong>
                            <span>${log.timestampISO || 'N/A'}</span>
                        </div>
                        <div style="margin: 10px 0; font-size: 1.1em;">
                            ${log.message}
                        </div>
                        ${log.userId ? `<div>üë§ User: ${log.userId}</div>` : ''}
                        ${log.sessionId ? `<div>üìù Session: ${log.sessionId}</div>` : ''}
                        ${contextHtml}
                    </div>
                `;
            }).join('');

            document.getElementById('logs').innerHTML = logsHtml || '<div style="color: #888; text-align: center; padding: 40px;">Nessun log trovato</div>';
        }

        window.filterLogs = function(filter) {
            currentFilter = filter;
            displayLogs();
        };

        window.loadLogs = loadLogs;

        // Auto-load on page load
        loadLogs();
    </script>
</body>
</html>
